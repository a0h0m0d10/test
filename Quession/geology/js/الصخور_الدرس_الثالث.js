(function() {
  "use strict";

  let questions = [
    {  question: " أهم فرق بين صخور البريشيا وصخور الكونجلوميرات هو ",
      answers: ["حجم الحبيبات"," شكل الحبيبات","الصلابة","مكان التواجد"],
      correctAnswer: 2
    },
     { question: "معظم الحجر الرملي الموجود في أسوان تكون",
      answers: ["داخل الأرض حيث درجة الحرارة تزيد عن درجة حرارة انصهار الكوارتز"," على سطح الأرض من تبريد اللاقا"," في الصحراء من حبيبات الرمل المترسبة والتي دفنت ثم تلاصقت الحبيبات معا بمواد معدنية","في الجبال حيث تسبب التحول بالضغط والحرارة في تلاحم بلورات الكوارتز معا"],
      correctAnswer: 3
    },
      {question: "غالبية الصخور الرسوبية تتكون من ",
      answers: ["زلط ورمل وطين","جير ورمل وطين","زلط وجير وجبس","طين وجبس وزلط"],
      correctAnswer: 2
    },
      {question: "يتوقع أن يكون الرمل الناعم قطر حبيباته حوالي ",
      answers: ["500 میکرون","100 میکرون","1.5 امم","2.5 مم"],
      correctAnswer: 2
    },
     { question: "الفتات الصخري الذي يقع فوق سطح عدم التوافق مباشرة يكون قطر حبيباته ",
      answers: ["أكبر من 2 مم"," يتراوح بين 2 مم و 62 ميكرون","يتراوح بين 62 ميكرون و4 ميكرون","أقل من 4 ميكرون"],
      correctAnswer: 1
    },
     { question: "الصخر الرسوبي الذي يظهر به التورق هو ",
      answers: [" الشيست الميكائي"," الصخر الطيني"," الطفل النفطي","الطفل"],
      correctAnswer: 4
    },
     { question: "الصخر الرسوبي المستخدم في الزينة هو صخر ",
      answers: ["الكونجلوميرات","الرخام","الجرانيت","البريشيا"],
      correctAnswer: 4
    },
     { question: "تتكون الصخور المكونة للصواعد والهوابط من معدن ",
      answers: ["الجبس","الانهيدريت","الكالسيت","الكوارتز"],
      correctAnswer: 3
    },
     { question: "أي الصخور التالية غير رسوبي ؟",
      answers: ["البريشيا","الدولومیت","الصوان"," الدوليرايت"],
      correctAnswer: 4
    },
     { question: "المعدن الذي لا يمكن وجوده في الصخور النارية هو معدن ",
      answers: ["الكالسيت","الأرثوكليز","الأوليفين","الكوارتز"],
      correctAnswer: 1
    },
     { question: "الصخر الرسوبي الذي تكون نتيجة عمليات كيميائية هو صخر ",
      answers: ["الجرانيت","الطفل","البريشيا"," الحجر الجيري"],
      correctAnswer: 4
    },
     { question: "العملية التي تؤدى إلى تكوين رواسب سميكة من الملح الصخري في بعض المناطق هي",
      answers: ["الانصهار","السيول","التكات","البخر"],
      correctAnswer: 4
    },
     { question: "قد يتواجد البترول في صخور",
      answers: ["الحجر الجيري","البازلت","الجرانيت","الجابرو"],
      correctAnswer: 1
    },
     { question: "أي الصخور الآتية تعتبر مصايد للبترول ؟",
      answers: ["الطفل والحجر الجيري"," الزلط والطين"," الرمل والطين","الرمل والحجر الجيري"],
      correctAnswer: 4
    },
     { question: "بعض الصخور غير الرسوبية تتكون نتيجة ",
      answers: ["تصلب المواد المنصهرة","التبخير والترسيب","تماسك الحبيبات","ترسيب الحبيبات"],
      correctAnswer: 1
    },
    {  question: "صخر يتواجد به اکثر عنصرين شيوعا في القشرة الأرضية هو ",
      answers: [" الحجر الجيري"," الحجر الرملي","الأنهيدريت","الدولوميت"],
      correctAnswer: 2
    },
     { question: "المعدن الذي قد ينتج من تبريد الصهارة ويدخل أيضا في تكوين صخر رسوبي هو معدن ",
      answers: ["الكوارتز","الكالسيت","الجبس","الهالیت"],
      correctAnswer: 1
    },
      {question: " الصخـر الـذي ينتمى لمجموعة الكربونات والذي يتكون نتيجة تبخر مياه البحر هو ",
      answers: ["الحجر الجيري","الانهيدريت","الجبس","الملح الصخري"],
      correctAnswer: 1
    },
      {question: "يمكن الاستدلال على وجود بيئة بحرية شديدة الحرارة عند العثور على رواسـب مـن",
      answers: ["الطفل","الأنهيدريت","القحم","البريشيا"],
      correctAnswer: 2
    },
     { question: "ترجع قدرة الحجر الرملي على تخزين البترول والغاز الطبيعي والمياه الجوفية إلى كونه صخر",
      answers: ["رسویی","فتاتی","مسامي","غنى بالكوارتز"],
      correctAnswer: 3
    },
     { question: "الصخر الرسوبي الذي قد يصاحب الفوالق مما يلي هو صخر ",
      answers: ["الفوسفات ","البريشيا"," الملح الصخري"," الكونجلوميرات"],
      correctAnswer: 2
    },
     { question: "تتحول المواد الهيدروكربونية من أصل بحري في الطين للحالة السائلة عند درجة حرارة حوالي",
      answers: ["50م","80 م","500م","2000م"],
      correctAnswer: 2
    },
     { question: "المعدن المتكون من تفاعل أيوني بين الكلور والصوديوم يكون صخر يتبع صخور",
      answers: ["الكربونات"," السيليكات","المتبخرات"," خامات الحديد"],
      correctAnswer: 3
    },
      {question: " العبارة الأفضل والتي تدعم الاستنتاج أن معظم سطح الأرض الظاهر حاليا كان يوما مغطى تماما بالماء هي أن ",
      answers: [" الشعاب المرجانية التي تكونت في الماضي توجد على حواف الكثير من القارات ","الثورات البركانية تحتوى كمية كبيرة من بخار الماء"," اتساع قاع البحار أدى إلى سحب كتل اليابس بعيدا ثم دفعهم في اتجاه البعض"," الصخور الرسوبية ذات الأصل البحري تغطى مناطق شاسعة من القارات"],
      correctAnswer: 4
    },
     { question: " تكونت معظم صخور الجبس نتيجة ",
      answers: [" تسخين صخور سبق تعرضها لعملية التحول"," تبريد وتصخر اللافا "," تضاغط وتلاحم بقايا أصداف وهياكل حيوانات بحرية"," ترسيب كيميائي للمعادن من مياه البحر"],
      correctAnswer: 4
    },
     { question: "نسيج صخر الرخام يكون ",
      answers: ["متورق","زجاجی","حبیبی","رقيق"],
      correctAnswer: 3
    },
     { question: "عند ملامسة الماجما للرمل يتكون صخر ",
      answers: ["الرخام","الحجر الرملي","الكوارتزايت","النيس"],
      correctAnswer: 3
    },
     { question: "الصخر الذي يحتوي على حفريات كاملة مما يلي هو ",
      answers: ["الرخام","البازلت","الجرانيت","الطفل"],
      correctAnswer: 4
    },
    {  question: "الصخور التي يمكن أن تتواجد بها حفريات واضحة هي ",
      answers: ["النارية الحمضية","النارية القاعدية","  الرسوبية الفتاتية"," المتحولة الكتلية"],
      correctAnswer: 3
    },
     { question: " الصخر الذي يختلف في التصنيف عن باقي الصخور مما يلي هو ",
      answers: ["الجبس","الحجر الرملي","الرخام"," الحجر الجيري"],
      correctAnswer: 3
    },
     { question: "الصخر الذي تتوقع أن يتواجد به حفريات مما يلي هو ",
      answers: ["الجرانيت","الطفل"," الأوبسيديان","النيس"],
      correctAnswer: 2
    },
   
     { question: "الصخر الذي تكون نتيجة التحول بالضغط والحرارة هو صخر ",
      answers: ["الاردواز","الرخام","الطفل"," الكوارتزايت"],
      correctAnswer: 1
    },
   
     { question: " الصخر المختلف في الصخور الآتية من حيث عامل التحول هو صخر",
      answers: ["الرخام"," الإردواز","النيس","الشيست"],
      correctAnswer: 1
    },
   
     { question: "عندما تضغط الماجما المكونة للاكوليت على الجرانيت يتكون ",
      answers: ["مصهور الجرانيت","النيس"," الميكا والفلسبار والكوارتز"," الشيست الميكاني"],
      correctAnswer: 2
    },
   
     { question: " يختلف النيس عن الشيست في",
      answers: [" أسباب التحول"," ظروف التحول"," طريقة ترتيب البلورات"," نسيج الصخر"],
      correctAnswer: 3
    },
   
     { question: " عند تعرض صخر رسویی قطر حبيباته (1 مم) لحرارة شديدة جدا يتكون صخر",
      answers: ["الرخام","الكوارتزايت","الإردواز","النيس"],
      correctAnswer: 2
    },
   
     { question: "الصخر الذي يحتوى على نسبة كبيرة من معدن الأرثوكليز من الصخور الآتية هو صخر",
      answers: ["الإردواز","الرخام","النيس","الشيست"],
      correctAnswer: 3
    },
   
     { question: " أي مما يلى يظل دون تغير أثناء تحول الصخر ؟",
      answers: ["النسيج"," نوع المعادن"," ترتيب المعادن","التركيب الكيميائي"],
      correctAnswer: 4
    },
   
     { question: "وجود المادة اللاحمة في الصخر يدل على أنه صخر ",
      answers: ["ناری برکانی","رسوبی فتانی"," ناری جوفی","متحول متورق"],
      correctAnswer: 2
    },
   
     { question: "الصخر الذي يحتوي على الميكا بنسبة أكبر من الصخور التالية هو ",
      answers: ["البازلت"," الحجر الجيري","الشيست","الحجر الرملي"],
      correctAnswer: 3
    }    
    
    

  ];

  const shuffledquestions = questions.sort(() => 0.5 - Math.random());

  function createQuiz() {
    let currentQuiz = shuffledquestions[quizCount];
    questionEl.innerHTML = currentQuiz.question;
  
    answerContEl.innerHTML = ``;
  
    currentQuiz.choices
      .sort(() => 0.5 - Math.random())
      .forEach((choice) => {
        createQuizChoices(choice);
      });
  }
  
  let questionIndex,
    currentQuestion,
    score,
    wrong,
    timeSpent,
    quizTimer,
    questionIsAnswered,
    isQuizDone;
  let quiz = document.getElementById("quiz");

  function initQuiz() {
  

    questionIndex = 0;
    currentQuestion = 1;
    questionIsAnswered = 0;
    score = 0;
    wrong = 0;
    timeSpent = "00:00";

    quiz.innerHTML = `
    <div id="stats">
    <p> Q : <span id="questionNumber">${currentQuestion}/${
      questions.length
    }</span></p>
    <p> correct : <span class="score" id="score">${score}</span></p>
    <p> Wrong : <span class="wrong" id="wrong">${wrong}</span></p>

    <p> Time <span id="timer">00:00</span></p>
    </div>
    <div id="progress-container"><span id="progress"></span></div>
    <section id="answers"></section>
    
    `;

    displayQuestion();
    startTimer();
  }

  function displayQuestion() {
    let question = questions[questionIndex];
    let answers = document.getElementById("answers");
    let answerNumber = 0;
    let output = `<h2 class="text-center bold"> ${
      question.question
    }</h2>`;

    for (let i in question.answers) {
      answerNumber++;
      output += `<div class="answer">
      <input type="radio" id="answer-${answerNumber}" name="answers" value="${answerNumber}">
      <label for="answer-${answerNumber}">
      <span class="answer-number"></span> ${question.answers[i]}
      </label>
      </div>`;
    }

    answers.innerHTML = output;
  }

  function startTimer() {
    let s = 0;
    let m = 0;
    let h = 0;
    let seconds = 0;
    let minutes = 0;
    let hours = 0;
    let timer = document.getElementById("timer");

    quizTimer = setInterval(function() {
      s++;

      if (s > 59) {
        s = 0;
        m++;
        seconds = "0" + s;
      }

      if (m > 59) {
        m = 0;
        h++;
        minutes = "00";
      }

      seconds = s > 9 ? s : "0" + s;
      minutes = m > 9 ? m : "0" + m;
      hours = h > 9 ? h : "0" + h;

      timeSpent = h
        ? hours + ":" + minutes + ":" + seconds
        : minutes + ":" + seconds;
      timer.textContent = timeSpent;
    }, 1000);
  }

  function displayResults() {
    let notification = document.getElementById("notification");
    notification.parentElement.removeChild(notification);
    quizTimer = null;
    isQuizDone = 1;

    let pageURL = window.location.href;
    let shareText = `I just finished this quiz and got ${score} out of ${
      questions.length
    } questions right.`;
    let fbShareURL = `https://www.facebook.com/sharer.php?u=${pageURL}&quote=${shareText}`;
    let twitterShareURL = `https://twitter.com/intent/tweet?text=${shareText} ${pageURL}`;

    quiz.innerHTML = `<section id="results" class="text-center">
    <h2 class="bold">إليك نتيجة الأختبار</h2>
    <p id="percentage">${scorePercentage()}%</p>
    <p>لقد أجبت على  <span class="bold">${score}</span> أسئلة من  <span class="bold">${
      questions.length
    }</span> </p>
    <p style="margin-top: 10px;">الوقت المستغرق : <span class="bold">${timeSpent}</span></p>


    <button type="button" id="start-over-btn" class="btn blue-btn"> حاول مرة أخرى</button>
    </section>`;
  }

  function goToNextQuestion() {
    currentQuestion++;
    questionIndex++;
    questionIsAnswered = 0;

    let notification = document.getElementById("notification");
    notification.parentElement.removeChild(notification);

    let questionNumber = document.getElementById("questionNumber");
    questionNumber.textContent = `${currentQuestion}/${questions.length}`;

    displayQuestion();
  }

  function submitAnswer(e) {
    let selectedAnswer = Number(e.target.value);
    let rightAnswer = questions[questionIndex].correctAnswer;
    let answers = document.getElementsByName("answers");
    let progress = document.getElementById("progress");

    questionIsAnswered = 1;

    progress.style.width = progressPercentage() + "%";

    let notification = document.createElement("div");
    let message = document.createElement("p");
    let label = e.target.nextElementSibling;
    notification.id = "notification";

    if (selectedAnswer === rightAnswer) {
      score++;
      message.textContent = " !إجابة صحيحة";
      label.classList.add("green-bg");
    } else {
      wrong++;
      message.textContent = "!إجابة خاطئة";
      label.classList.add("red-bg");

      answers.forEach(answer => {
        if (Number(answer.value) !== rightAnswer) return;

        answer.nextElementSibling.classList.add("green-bg");
      });
    }

    let button = document.createElement("button");
    button.classList.add("blue-btn");

    if (isLastQuestion()) {
      button.id = "show-results-btn";
      button.textContent = "أعرض النتيجة ";
      clearInterval(quizTimer);
      quizTimer = null;
    } else {
      button.id = "next-btn";
      button.textContent = "السؤال التالي";
    }

    notification.appendChild(message);
    notification.appendChild(button);
    quiz.insertAdjacentElement("afterend", notification);

    button.focus();

    answers.forEach(answer => (answer.disabled = "disabled"));

    document.getElementById("score").textContent = score;
    document.getElementById("wrong").textContent = wrong;

  }

  let scorePercentage = () => (score / questions.length * 100).toFixed(0);
  let progressPercentage = () =>
    (currentQuestion / questions.length * 100).toFixed(0);
  let isLastQuestion = () => currentQuestion === questions.length;

  function spaceBarHandler() {
    if (document.querySelector(".quiz-intro")) {
      initQuiz();
    }

    if (questionIsAnswered && quizTimer) {
      goToNextQuestion();
    }

    if (!quizTimer && !isQuizDone) {
      displayResults();
      console.log("last");
    }
  }

  function numericKeyHandler(e) {
    let answers = document.getElementsByName("answers");

    answers.forEach(answer => {
      if (answer.value === e.key) {
        if (questionIsAnswered) return;

        answer.checked = "checked";

        let event = new Event("change");
        answer.dispatchEvent(event);
        submitAnswer(event);

        questionIsAnswered = 1;
      }
    });
  }

  document.addEventListener("click", function(e) {
    if (
      e.target.matches("#start-quiz-btn") ||
      e.target.matches("#start-over-btn")
    )
      initQuiz();
    if (e.target.matches("#next-btn")) goToNextQuestion();
    if (e.target.matches("#show-results-btn")) displayResults();
  });

  document.addEventListener("change", function(e) {
    if (e.target.matches('input[type="radio"]')) submitAnswer(e);
  });

  document.addEventListener("keyup", function(e) {
    if (e.keyCode === 32) spaceBarHandler(); // init quiz / go to next question
    if (e.keyCode >= 48 && e.keyCode <= 57) numericKeyHandler(e); // choose an answer
  });

  document
    .getElementById("shortcuts-info-btn")
    .addEventListener("click", function() {
      let info = document.querySelector(".shortcuts-info");
      info.classList.toggle("display-block");
    });
})();